<html>

<head>
    <meta charset='utf-8'/>
    <meta http-equiv="X-UA-Compatible" content="chrome=1"/>
    <meta name="description" content="ios-driver : IOS native app automation"/>
    <link href="stylesheets/prettify.css" type="text/css" rel="stylesheet"/>
    <script type="text/javascript" src="javascripts/prettify.js"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>ios-driver</title>
</head>

<body onload="prettyPrint()">

<!-- HEADER -->
<div id="header_wrap" class="outer">
    <header class="inner">
        <a id="forkme_banner" href="https://github.com/freynaud/ios-driver">View on GitHub</a>

        <h1 id="project_title">ios-driver</h1>

        <h2 id="project_tagline">IOS automation for native, hybrid and mobile web.</h2>

        <div id="menu">
            <ul>
                <li><a href="index.html" id="home">Home</a></li>
                <li><a href="setup.html" id="setup">Setup</a></li>
                <li><a href="inspector.html" id="inspector">Inspector</a></li>
                <li class="active"><a href="native.html" id="native">Native</a></li>
                <li><a href="safari.html" id="safari">Safari</a></li>
                <li><a href="hybrid.html" id="hybrid">Hybrid</a></li>
                <li><a href="bug.html" id="bug">Report a bug</a></li>
            </ul>
        </div>


        <section id="downloads">
            <a class="zip_download_link"
               href="https://github.com/downloads/freynaud/ios-driver/ios-server-0.5.0.jar">Download 0.5.0</a>
        </section>
    </header>
</div>

<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
    <section id="main_content" class="inner">


        <h3>Writing the first test for native ios apps</h3>

        <p>Make sure you've been through the  <a href="setup.html" id="setup2">setup</a> page and that all
            the requirements are met</p>

        <p>Start the server and connect the Intl moutains demo app from Apple through the following command</p>
<pre>
$java -jar server-standalone-0.5.0.jar -aut ~/Documents/build/InternationalMountains.app -port 4444
    </code></pre>

        <p>The following code starts the app, finds some elements, clicks on the first element, prints some text, takes a screenshot and
            quits.</p>

<pre class="prettyprint" >
public static void main(String[] args) throws MalformedURLException {
    // create a selenium desiredCapabilities object with the right values.
    DesiredCapabilities cap = IOSCapabilities.iphone("InternationalMountains", "1.1");
    // start the application
    RemoteWebDriver driver = new RemoteWebDriver(new URL("http://localhost:4444/wd/hub"), cap);

    // check that the 9 mountains of the app are there.
    List cells = driver.findElements(By.className("UIATableCell"));
    Assert.assertEquals(9,cells.size());

    // get the 1st mountain
    WebElement first = cells.get(0);
    first.click();

    // take a screenshot using the normal selenium api.
    TakesScreenshot screen =(TakesScreenshot)new Augmenter().augment(driver);
    File ss = new File("screenshot.png");
    screen.getScreenshotAs(OutputType.FILE).renameTo(ss);
    System.out.println("screenshot take :"+ss.getAbsolutePath());

    // access the content
    By selector = By.xpath("//UIAStaticText[contains(@name,'climbed')]");
    WebElement text = driver.findElement(selector);
    System.out.println(text.getAttribute("name"));

    // end the test
    driver.quit();
}
</pre>

        <p>will print out :</p>

<pre>
Mountain 1 was first climbed on 29 May 1953 and has a height of 8,848 meters
</pre>

        <p>and you now have a screenshot of the old mountain details :</p>
        <img src="images/screenshot.png" alt="step2.png" height='480' width='320'>


        <h3>Native tests and localization</h3>

        <p>IOS automation is very content based. There are no IDs like for web pages. This makes testing of
            localized pages a bit trickier. Fortunately the localization data is embedded into the
            app, so the server can access it if you know the key for the content. </p>
        <p> In the previous example, the app started in the default language, English and the locator is
            hardcoded to English. Let's start it in Chinese, and make the test content free.</p>

        <p> To specify the language : </p>


<pre>

    DesiredCapabilities cap = IOSCapabilities.iphone("InternationalMountains", "1.1");
    cap.setCapability(IOSCapabilities.LANGUAGE,"zh");

</pre>


        <p> and make the locator content free : </p>

<pre>
    // access the content
    By contentFree = By.xpath("//UIAStaticText[matches(@name,l10n('sentenceFormat'))]");
    WebElement text = driver.findElement(contentFree);


</pre>


        <p>The complete test code is now content free, and you can switch between en, fr and zh without having
            to maintain your own localization dictionary. You can now start building your generic page objects,
            and focus on the functionality rather than the content. </p>

        Complete code for zh :
<pre class="prettyprint" >


public static void main(String[] args) throws MalformedURLException {
    // create a selenium desiredCapabilities object with the right values.
    DesiredCapabilities cap = IOSCapabilities.iphone("InternationalMountains", "1.1");
    cap.setCapability(IOSCapabilities.LANGUAGE,"zh");

    // start the application
    RemoteWebDriver driver = new RemoteWebDriver(new URL("http://localhost:4444/wd/hub"), cap);

    // check that the 9 mountains of the app are there.
    List<WebElement> cells = driver.findElements(By.className("UIATableCell"));
    Assert.assertEquals(9,cells.size());

    // get the 1st mountain
    WebElement first = cells.get(0);
    first.click();

    // take a screenshot using the normal selenium api.
    TakesScreenshot screen =(TakesScreenshot)new Augmenter().augment(driver);
    File ss = new File("screenshot-zh.png");
    screen.getScreenshotAs(OutputType.FILE).renameTo(ss);
    System.out.println("screenshot take :"+ss.getAbsolutePath());

    // access the content
    By contentFree = By.xpath("//UIAStaticText[matches(@name,l10n('sentenceFormat'))]");
    WebElement text = driver.findElement(contentFree);
    System.out.println(text.getAttribute("name"));

    // end the test
    driver.quit();
    }
</pre>

        will print out :
<pre>
      screenshot take :/Users/freynaud/Documents/workspace/ios-driver/screenshot-zh.png
      山 1 是8,848米高。它第一次攀登了在29 May 1953。
</pre>

        <p>and produce the following screenshot :</p>

        <img src="images/screenshot-zh.png" alt="step2.png" height='480' width='320'>



        <p>The previous example had some "magic" values. UIATableCell, UIAStaticText, sentenceFormat. If you're
            the developer of the app, those value will make sense. If you're not, you can use the inspector to
            find them. The inspector allows you to have the 'inspect element' feature you use to write a selenium
            web test. Read more about it here : <a href="inspector.html" id="inspector2">Inspector</a></p>


        <h3>Creating locators :</h3>
        <p>First, have a look at the <a href="inspector.html">inspector</a>, it will give you a lot of information about the
        internals of the application under test.</p>

        <p>UIAutomation elements don't have id. You need to use some of their other properties to
            identify them.The webdriver protocol isn't meant to be used for non-web applications, so
            there is a bit of mapping involved.</p>

        <h5>name, value, label</h5>
        <p>are mapped to linkText and partialLinkText</p>
        <pre class="prettyprint">

            By b = By.linkText("name=theName");
            WebElement element = driver.findElement(b);

            By b = By.linkText("value=theValue");
            WebElement element = driver.findElement(b);

            By b = By.linkText("label=theLabel");
            WebElement element = driver.findElement(b);

        </pre>

        <p>partial/ regex matches are achieved using partialLinkText</p>

        <pre class="prettyprint">
            By b = By.partialLinkText("name=portionOfTheName");
            WebElement element = driver.findElement(b);

            // or regex.
            By b = By.partialLinkText("name=portion(.*)Name");
            WebElement element = driver.findElement(b);

            // and can also handle localization
            By b = By.partialLinkText("name=l10n('yourContentKey')");
            WebElement element = driver.findElement(b);

        </pre>

        <h5>type</h5>
       <p>selection based on the element type are done with class name.</p>
        <pre class="prettyprint">
            By b = By.className("UIAButton");
            WebElement element = driver.findElement(b);
        </pre>

        <h5>xpath</h5>
       <p>xpath2 is the most powerful mechanism for selector on ios-driver.It allows to combine all
       the criteria above.</p>

        <p>To match ""山 1 是8,848米高。它第一次攀登了在29 May 1953" from the Intl mountain demo app for
        instance you can use :</p>
        <pre class="prettyprint">

            By b =  By.xpath("//*[matches(@name,l10n('meterFormat'))]");
            // or
            By b =  By.xpath("//UIAStaticText[matches(@name,l10n('meterFormat'))]");
            // or
            By b =  By.xpath("//UIAStaticText[@name,'山 1 是8,848米高。它第一次攀登了在29 May 1953')]");
            // or
            By b =  By.xpath("//UIAStaticText[contains(@name,'山')]");


       </pre>

        <p>will match any UIElement with name matching the value behind the meterFormat content key.</p>





        <h3>Starting parameters :</h3>

        <p>The map of parameters ( the DesiredCapabilities object ) accept a set of parameters that
            will
            define the configuration the simulator will start with:</p>

        <lu>
            <li>device: iphone (default) | ipad</li>
            <li>language: en | fr | zh . The list of supported languages depends on your
                application.
            </li>
            <li>locale: en_GB ...</li>
            <li>CFBundleName : UIACatalog | Safari ... name for your application, specified in its
                info.plist
            </li>
            <li>CFBundleVersion : {string} version of the app to start ( optional )</li>
            <li>variation: (Regular | Retina35 | Retina4) for iphone. (Regular | Retina) for ipad
            </li>
            <li>simulator : true</li>
            <li>ios.switches : an array of system parameters that will be passed to the app when it
                is launched. Useful if the app can be configured to point to a QA envt with system
                variable for instance.
            </li>
            <li>sdkVersion : {string} 5.0 | .. | 6.1</li>
            <li> TODO doc : magic prefix plist_</li>
        </lu>

        <h3>Executing raw instruments JS :</h3>

        <p>The underlying framework running the native part is instruments. Instruments tests are
            written in JS. It's possible to execute instruments scripts directly by using the default
        webdriver client. The arguments and returned objects follow the webdriver convention.</p>

        <p>For example :</p>
<pre class="prettyprint" >

/**
*  instruments scripts can return a list of element. the elements can be used later on in the tests.
*/
@Test
public void testShouldBeAbleToReturnAnArrayOfWebElements() {
    WebDriver driver = new RemoteWebDriver(...);
    // ...
    List<WebElement> items = (List<WebElement>) executeScript("return UIATarget.localTarget().frontMostApp().windows()");
    assertEquals(items.size(), 2);
    driver.quit();
}

/**
* Elements can be passed as parameter for the raw instruments scripts.
*/
@Test
public void testShouldBeAbleToPassAWebElementAsArgument() {
    WebDriver driver = new RemoteWebDriver(...);
    // ...
    WebElement cell = driver.findElement(By.xpath("//UIATableCell[@name='" + buttonsName + "']"));
    String res = (String) executeScript("return arguments[0].type();", cell);
    assertEquals(res, "UIATableCell");
    driver.quit();
}

private Object executeScript(String script, Object... args) {
    return ((JavascriptExecutor) driver).executeScript(script, args);
}
</pre>

<p>Some instruments JS methods do not work as expected and have been overwritten in ios-driver. You
can find the documentation about those differences and all the additional functions can be found
 <a href="jsdoc/index.html">here.</a></p>

    </section>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
    <footer class="inner">
        <p class="copyright">ios-driver maintained by <a
                href="https://github.com/freynaud">freynaud</a></p>

        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
    </footer>
</div>
</body>
</html>
